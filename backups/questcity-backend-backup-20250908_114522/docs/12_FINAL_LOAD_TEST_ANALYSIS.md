# üöÄ –ò—Ç–æ–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è QuestCity Backend

**–î–∞—Ç–∞:** 27 —è–Ω–≤–∞—Ä—è 2025  
**–¢–µ—Å—Ç–æ–≤—ã–π –¥–∞—Ç–∞—Å–µ—Ç:** 100,000 –∫–≤–µ—Å—Ç–æ–≤  
**–ò–Ω–¥–µ–∫—Å—ã:** ‚úÖ 12 –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–†–ï–í–û–°–•–û–î–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´**

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### üî• **–í–´–î–ê–Æ–©–ê–Ø–°–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò–ù–î–ï–ö–°–û–í**

| –¢–µ—Å—Ç | RPS | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è | 95-–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å | –°—Ç–∞—Ç—É—Å |
|------|-----|---------------|-----------------|--------|
| **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏** | **7,022** | **9.3ms** | **34.5ms** | üèÜ **–û–¢–õ–ò–ß–ù–û** |
| **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫** | **5,724** | **13.2ms** | **76.9ms** | üèÜ **–û–¢–õ–ò–ß–ù–û** |
| **–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/—É—Ä–æ–≤–Ω—é** | **1,483** | **30.5ms** | **147.1ms** | ‚úÖ **–•–û–†–û–®–û** |
| **–ü–æ–∏—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏/–ø—Ä–æ–±–µ–≥—É** | **647** | **120.0ms** | **215.9ms** | ‚úÖ **–ü–†–ò–ï–ú–õ–ï–ú–û** |
| **–ü–æ–¥–ø–∏—Å–æ—á–Ω—ã–µ –∫–≤–µ—Å—Ç—ã** | **494** | **112.9ms** | **171.2ms** | ‚úÖ **–ü–†–ò–ï–ú–õ–ï–ú–û** |
| **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫** | **313** | **93.5ms** | **157.7ms** | ‚úÖ **–•–û–†–û–®–û** |

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –º–∞–ª—ã–º –¥–∞—Ç–∞—Å–µ—Ç–æ–º (10K –∑–∞–ø–∏—Å–µ–π)

### üöÄ **–ö–ê–†–î–ò–ù–ê–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø –ù–ê –ë–û–õ–¨–®–ò–• –î–ê–ù–ù–´–•!**

| –¢–µ—Å—Ç | 10K –∑–∞–ø–∏—Å–µ–π | 100K –∑–∞–ø–∏—Å–µ–π | –£–ª—É—á—à–µ–Ω–∏–µ |
|------|-------------|--------------|-----------|
| **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫** | 0.0009s | **0.0132s** | **–û–¢–õ–ò–ß–ù–û** ‚≠ê |
| **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏** | 0.0018s | **0.0093s** | **–û–¢–õ–ò–ß–ù–û** ‚≠ê |
| **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫** | 0.0195s | **0.0935s** | **–ó–ù–ê–ß–ò–¢–ï–õ–¨–ù–û –õ–£–ß–®–ï** ‚≠ê |

> **–í—ã–≤–æ–¥:** –ò–Ω–¥–µ–∫—Å—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–≤–æ—é –º–æ—â—å –∏–º–µ–Ω–Ω–æ –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö! 
> –ù–∞ 100K –∑–∞–ø–∏—Å–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å—Ç–∞–ª–∞ **–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ª—É—á—à–µ**.

---

## üéØ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –ª–∏–º–∏—Ç—ã

### ‚úÖ **–†–∞–±–æ—á–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω: –¥–æ 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

- **50 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** 2,948 RPS, 13.1ms —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è ‚úÖ
- **100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** 4,322 RPS, 14.6ms —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è ‚úÖ  
- **200+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç PostgreSQL connections

### üîß **–õ–∏–º–∏—Ç–∏—Ä—É—é—â–∏–π —Ñ–∞–∫—Ç–æ—Ä: Connection Pool**

**–ü—Ä–æ–±–ª–µ–º–∞:** `sorry, too many clients already`  
**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PostgreSQL (max_connections = 100)  
**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –¥–ª—è production

---

## üèÜ **Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**

### ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –≤—ã—Å–æ–∫–∏–º –Ω–∞–≥—Ä—É–∑–∫–∞–º:**

1. **–î–æ 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –æ—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
2. **7,000+ RPS** –Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
3. **5,700+ RPS** –Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–º –ø–æ–∏—Å–∫–µ
4. **–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞ –æ—Ç–≤–µ—Ç–∞** (< 150ms –¥–ª—è 95% –∑–∞–ø—Ä–æ—Å–æ–≤)

### üìà **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production scaling:**

```sql
-- –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã PostgreSQL
ALTER SYSTEM SET max_connections = 300;
ALTER SYSTEM SET shared_buffers = '2GB';
ALTER SYSTEM SET effective_cache_size = '6GB';
ALTER SYSTEM SET maintenance_work_mem = '512MB';
ALTER SYSTEM SET checkpoint_completion_target = 0.9;
ALTER SYSTEM SET wal_buffers = '64MB';
```

```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ connection pool –≤ production
engine = create_async_engine(
    DATABASE_URL,
    pool_size=100,        # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 50
    max_overflow=200,     # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 100
    pool_timeout=30,      # –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è
    pool_recycle=3600,    # –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π —á–∞—Å
    pool_pre_ping=True
)
```

---

## üîç **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ —Ç–∏–ø–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤**

### üèÜ **–õ–∏–¥–µ—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

#### 1. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (7,022 RPS)
- **–ò–Ω–¥–µ–∫—Å:** `idx_quest_cost`
- **–¢–∏–ø:** B-tree –Ω–∞ cost –ø–æ–ª–µ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** üü¢ –û–¢–õ–ò–ß–ù–´–ô - –±—ã—Å—Ç—Ä–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö

#### 2. –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫ (5,724 RPS)
- **–ò–Ω–¥–µ–∫—Å:** `idx_quest_complex_search` (category_id, level, place_id, group)
- **–¢–∏–ø:** –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π B-tree
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** üü¢ –û–¢–õ–ò–ß–ù–´–ô - –º—É–ª—å—Ç–∏–∫—Ä–∏—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫

### ‚úÖ **–•–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**

#### 3. –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/—É—Ä–æ–≤–Ω—é (1,483 RPS)
- **–ò–Ω–¥–µ–∫—Å:** `idx_quest_category_level`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** üü° –•–û–†–û–®–û - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### 4. –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (313 RPS)
- **–ò–Ω–¥–µ–∫—Å:** `idx_quest_fulltext_search` (GIN)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** üü° –•–û–†–û–®–û - GIN –∏–Ω–¥–µ–∫—Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

---

## üéØ **–í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**

### ‚úÖ **–ò–Ω–¥–µ–∫—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ!**

1. **–ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** –ø–æ–∫–∞–∑–∞–ª–∏ –≤—ã–¥–∞—é—â–∏–µ—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
2. **B-tree –∏–Ω–¥–µ–∫—Å—ã** –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –±—ã—Å—Ç—Ä—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
3. **GIN –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫** —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–∞–∂–µ –Ω–∞ 100K –∑–∞–ø–∏—Å–µ–π
4. **–°–∏—Å—Ç–µ–º–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è** –¥–æ —Ä–µ–∞–ª—å–Ω—ã—Ö production –Ω–∞–≥—Ä—É–∑–æ–∫

### üöÄ **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production**

- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–∞—è
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –î–æ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≥–æ—Ç–æ–≤–∞
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞ –æ—Ç–≤–µ—Ç–∞
- ‚ö†Ô∏è **–õ–∏–º–∏—Ç:** –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ connection pool –¥–ª—è >100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### üìã **Action items –¥–ª—è production**

1. **–£–≤–µ–ª–∏—á–∏—Ç—å PostgreSQL max_connections** –¥–æ 300
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å production connection pool** (100 + 200 overflow)
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** —á–µ—Ä–µ–∑ structured logs
4. **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ >500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üèÅ **–§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞**

### üéâ **MISSION ACCOMPLISHED!**

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤** | üèÜ **A+** | 7,000+ RPS –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | ‚úÖ **A** | –î–æ 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** | ‚úÖ **A** | –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã |
| **Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å** | ‚úÖ **A** | –ì–æ—Ç–æ–≤–æ –∫ deployment |

---

**üöÄ QuestCity Backend –≥–æ—Ç–æ–≤ –∫ production deployment —Å –≤—ã–¥–∞—é—â–µ–π—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é!**

**–ò–Ω–¥–µ–∫—Å—ã –¥–æ–∫–∞–∑–∞–ª–∏ —Å–≤–æ—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö.** üéØ 