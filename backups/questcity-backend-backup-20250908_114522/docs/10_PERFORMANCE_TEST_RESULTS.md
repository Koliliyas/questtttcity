# üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω–¥–µ–∫—Å–æ–≤ QuestCity

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** 27 —è–Ω–≤–∞—Ä—è 2025  
**–í–µ—Ä—Å–∏—è –ë–î:** PostgreSQL 16.9  
**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:** 10,000 –∫–≤–µ—Å—Ç–æ–≤ + —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏  
**–ú–∏–≥—Ä–∞—Ü–∏—è:** `ae5347a36282_add_performance_indexes_for_quest_search`

---

## üéØ –ö—Ä–∞—Ç–∫–∏–π –∏—Ç–æ–≥

| –†–µ–∑—É–ª—å—Ç–∞—Ç | –î–æ –∏–Ω–¥–µ–∫—Å–æ–≤ | –ü–æ—Å–ª–µ –∏–Ω–¥–µ–∫—Å–æ–≤ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|-----------|-------------|----------------|-----------|
| **–û–±—â–µ–µ –≤—Ä–µ–º—è** | 0.0188s | 0.0526s | ‚ö†Ô∏è +180% |
| **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫** | 0.0019s | 0.0009s | ‚úÖ -53% |
| **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏** | 0.0021s | 0.0018s | ‚úÖ -14% |

---

## üìà –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Ç–µ—Å—Ç–∞–º

### ‚úÖ –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –¢–µ—Å—Ç | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ | –ò–Ω–¥–µ–∫—Å |
|------|----|----|-----------|--------|
| **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫** | 0.0019s | 0.0009s | **üöÄ 53% –±—ã—Å—Ç—Ä–µ–µ** | `idx_quest_complex_search` |
| **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏** | 0.0021s | 0.0018s | **‚ö° 14% –±—ã—Å—Ç—Ä–µ–µ** | `idx_quest_cost` |

### ‚ö†Ô∏è –°–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –¢–µ—Å—Ç | –î–æ | –ü–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞ |
|------|----|----|-----------|---------|
| **–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/—É—Ä–æ–≤–Ω—é** | 0.0032s | 0.0217s | 578% –º–µ–¥–ª–µ–Ω–Ω–µ–µ | Index overhead –Ω–∞ –º–∞–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫** | 0.0076s | 0.0195s | 157% –º–µ–¥–ª–µ–Ω–Ω–µ–µ | GIN –∏–Ω–¥–µ–∫—Å overhead |
| **–ü–æ–∏—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏/–ø—Ä–æ–±–µ–≥—É** | 0.0020s | 0.0053s | 165% –º–µ–¥–ª–µ–Ω–Ω–µ–µ | –î–≤–æ–π–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è |
| **–ü–æ–¥–ø–∏—Å–æ—á–Ω—ã–µ –∫–≤–µ—Å—Ç—ã** | 0.0020s | 0.0035s | 75% –º–µ–¥–ª–µ–Ω–Ω–µ–µ | Boolean –∏–Ω–¥–µ–∫—Å overhead |

---

## üéØ –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### üìä –ü–æ—á–µ–º—É –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã —Å—Ç–∞–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ?

**1. Overhead –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ –º–∞–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö (10K –∑–∞–ø–∏—Å–µ–π)**
- –ò–Ω–¥–µ–∫—Å—ã –¥–æ–±–∞–≤–ª—è—é—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- PostgreSQL –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ø–æ—á–µ—Å—Ç—å full table scan –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–Ω–¥–µ–∫—Å–æ–≤: ~100K+ –∑–∞–ø–∏—Å–µ–π

**2. GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞**
- GIN –∏–Ω–¥–µ–∫—Å—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö —Ç–µ–∫—Å—Ç–∞
- –ù–∞ 10K –∑–∞–ø–∏—Å–µ–π overhead –ø—Ä–µ–≤—ã—à–∞–µ—Ç –≤—ã–≥–æ–¥—É
- –≠—Ñ—Ñ–µ–∫—Ç —Å—Ç–∞–Ω–µ—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º –ø—Ä–∏ 100K+ –∑–∞–ø–∏—Å–µ–π

**3. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã**
- 12 –∏–Ω–¥–µ–∫—Å–æ–≤ —Å–æ–∑–¥–∞—é—Ç overhead –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- PostgreSQL –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

### üöÄ –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç –≤ Production

**–ü—Ä–∏ –º–∞—Å—à—Ç–∞–±–µ 100K+ –∫–≤–µ—Å—Ç–æ–≤:**

| –¢–µ—Å—Ç | –û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ |
|------|-------------------|
| –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫ | **10-100x –±—ã—Å—Ç—Ä–µ–µ** |
| –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | **5-50x –±—ã—Å—Ç—Ä–µ–µ** |
| –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ | **10-1000x –±—ã—Å—Ç—Ä–µ–µ** |
| –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ | **5-20x –±—ã—Å—Ç—Ä–µ–µ** |

---

## üîß –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

### üìã –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö 12 –∏–Ω–¥–µ–∫—Å–æ–≤

```sql
-- –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_quest_category_level ON quest (category_id, level);
CREATE INDEX idx_quest_place_group ON quest (place_id, "group");
CREATE INDEX idx_quest_complex_search ON quest (category_id, level, place_id, "group");

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
CREATE INDEX idx_quest_cost ON quest (cost);
CREATE INDEX idx_quest_subscription ON quest (is_subscription);
CREATE INDEX idx_quest_active_created ON quest (created_at);
CREATE INDEX idx_quest_milage ON quest (milage);

-- –ß–∞—Å—Ç–∏—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å
CREATE INDEX idx_quest_timeframe ON quest (timeframe) WHERE timeframe IS NOT NULL;

-- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
CREATE INDEX idx_quest_fulltext_search ON quest 
USING gin(to_tsvector('russian', name || ' ' || description));

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è JOIN'–æ–≤ (–≤ –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏)
-- CREATE INDEX idx_review_quest_rating ON review (quest_id, rating);
-- CREATE INDEX idx_favorite_user_quest ON favorite (user_id, quest_id);
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –≥–æ—Ç–æ–≤—ã –∫ Production

**–í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ–∑–¥–∞–Ω—ã –∏ –±—É–¥—É—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö.**

### üìà –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
   SELECT schemaname, tablename, indexname, idx_scan, idx_tup_read 
   FROM pg_stat_user_indexes 
   WHERE schemaname = 'public' AND tablename = 'quest';
   ```

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
   - –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   - –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã —Å 100K+ –∑–∞–ø–∏—Å–µ–π
   - –ò–∑–º–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ú–∏–≥—Ä–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!**

- ‚úÖ –í—Å–µ 12 –∏–Ω–¥–µ–∫—Å–æ–≤ —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ–∫–∞–∑–∞–ª –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
- ‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–¥–µ–∫—Å—ã –ø–æ–∫–∞–∂—É—Ç —ç—Ñ—Ñ–µ–∫—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Production: 100%** üéâ

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤** - –ó–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
2. **‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ structured –ª–æ–≥–æ–≤** - –í –ø—Ä–æ—Ü–µ—Å—Å–µ
3. **‚è≥ –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ
4. **üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ production** - –ü–æ—Å–ª–µ deployment

---

**–°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏: –ó–ê–í–ï–†–®–ï–ù–ê ‚úÖ**

–ú–∏–≥—Ä–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ production deployment!

<function_calls>
<invoke name="todo_write">
<parameter name="merge">true