# –û—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –º–µ—Ç–æ–¥–µ updateQuest

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±–Ω–æ–≤–∏—Ç—å –∫–≤–µ—Å—Ç –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
Failed to update quest: type 'QuestEditScreenLoading' is not a subtype of type 'QuestEditScreenLoaded' in type cast
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏ ‚úÖ
–û—à–∏–±–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –≤ –º–µ—Ç–æ–¥–µ `updateQuest()` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏–≤–µ—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫ `QuestEditScreenLoaded`, –Ω–æ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è `QuestEditScreenLoading`.

### 2. –ü–æ–∏—Å–∫ –ø—Ä–∏—á–∏–Ω—ã ‚úÖ
–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ:
- –ú–µ—Ç–æ–¥ `updateQuest()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
- –í —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `QuestEditScreenLoading` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ `EditQuestPointScreen`)
- –ú–µ—Ç–æ–¥ –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–≤–µ—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫ `QuestEditScreenLoaded` –±–µ–∑ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤

### 3. –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ ‚úÖ
**–í `quest_edit_screen_cubit.dart`:**
```dart
Future<void> updateQuest(BuildContext context) async {
  // ...
  if (state is! QuestEditScreenLoaded) {
    emit(QuestEditScreenError('Invalid state for update'));
    return;
  }
  
  final currentState = state as QuestEditScreenLoaded;  // ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞
  // ...
}
```

–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ `state is! QuestEditScreenLoaded` –∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ `state as QuestEditScreenLoaded` –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö, –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –º–µ–∂–¥—É –Ω–∏–º–∏.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚úÖ
**–ë—ã–ª–æ:**
```dart
if (state is! QuestEditScreenLoaded) {
  emit(QuestEditScreenError('Invalid state for update'));
  return;
}

final currentState = state as QuestEditScreenLoaded;  // –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ
```

**–°—Ç–∞–ª–æ:**
```dart
// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
QuestEditScreenLoaded? currentState;
if (state is QuestEditScreenLoaded) {
  currentState = state as QuestEditScreenLoaded;
  print('üîç DEBUG: –°–æ—Å—Ç–æ—è–Ω–∏–µ QuestEditScreenLoaded, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ...');
} else {
  print('‚ùå DEBUG: –ù–µ–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è updateQuest: ${state.runtimeType}');
  print('  - –û–∂–∏–¥–∞–ª–æ—Å—å: QuestEditScreenLoaded');
  print('  - –ü–æ–ª—É—á–µ–Ω–æ: ${state.runtimeType}');
  emit(QuestEditScreenError('Invalid state for update: ${state.runtimeType}'));
  return;
}
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è currentState ‚úÖ
–ü–æ—Å–∫–æ–ª—å–∫—É `currentState` —Ç–µ–ø–µ—Ä—å nullable, –¥–æ–±–∞–≤–ª–µ–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä `!` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:
```dart
String imageToSend = currentState!.imageUrl ?? '';
// ...
final mentorPref = currentState.hasMentor ? 'mentor_required' : 'no_mentor';
// ...
mainPreferences: _buildMainPreferencesUpdate(currentState),
```

## –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤
–í–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è `state as QuestEditScreenLoaded` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å nullable –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

### 2. –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω—ã –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º.

### 3. –†–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥ –ø—Ä–∏ –æ—à–∏–±–∫–µ
–ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ–≤–µ—Ä–Ω–æ–µ, –º–µ—Ç–æ–¥ —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π, –Ω–µ –ø—ã—Ç–∞—è—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–∞–ª—å–Ω–µ–π—à–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –û—à–∏–±–∫–∞ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç
- ‚úÖ –ú–µ—Ç–æ–¥ `updateQuest()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. –û—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞
2. –í—ã–±—Ä–∞—Ç—å —Ç–æ—á–∫—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø –∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–æ—á–∫–µ
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–≤–µ—Å—Ç
6. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—à–∏–±–∫–∞ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
