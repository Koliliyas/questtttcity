# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ API —Å–æ–∑–¥–∞–Ω–∏—è –∫–≤–µ—Å—Ç–æ–≤

**–î–∞—Ç–∞:** 28 –∏—é–ª—è 2025  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–û  

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ API —Å–æ–∑–¥–∞–Ω–∏—è –∫–≤–µ—Å—Ç–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:

### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:
1. **–§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: –ü–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è URL `https://example.com/test.jpg`, –∞ –æ–∂–∏–¥–∞–µ—Ç—Å—è base64 —Å—Ç—Ä–æ–∫–∞
2. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è**:
   - `credits` - –∫—Ä–µ–¥–∏—Ç—ã –∑–∞ –∫–≤–µ—Å—Ç (cost, reward)
   - `main_preferences` - –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è (types, places, vehicles, tools)
   - `mentor_preferences` - –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –º–µ–Ω—Ç–æ—Ä–∞ (base64 Excel —Ñ–∞–π–ª)
   - `points` - –æ—á–∫–∏ –∑–∞ –∫–≤–µ—Å—Ç (–º–∞—Å—Å–∏–≤ —Ç–æ—á–µ–∫)
3. **üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ primary key - `duplicate key value violates unique constraint "pk_quest"`

## üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–∫—Ä–∏–ø—Ç–µ

**–§–∞–π–ª:** `test_quests_api.sh`

#### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–≤–µ—Å—Ç–∞:

```json
{
    "name": "–¢–µ—Å—Ç–æ–≤—ã–π –∫–≤–µ—Å—Ç",
    "description": "–û–ø–∏—Å–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API",
    "image": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==",
    "credits": {
        "cost": 10,
        "reward": 20
    },
    "main_preferences": {
        "types": [],
        "places": [],
        "vehicles": [],
        "tools": []
    },
    "mentor_preferences": "UEsDBBQACAgIAAAAAAAAAAAAAAAAAAAAAAAUAAAAeGwvd29ya2Jvb2sueG1s",
    "merch": [],
    "points": []
}
```

### 2. ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù –ê–í–¢–û–ò–ù–ö–†–ï–ú–ï–ù–¢ PRIMARY KEY

**–ü—Ä–æ–±–ª–µ–º–∞:** –í PostgreSQL –Ω–µ –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –¥–ª—è primary key —Å—Ç–æ–ª–±—Ü–æ–≤
 
**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `int32_pk` –≤ `src/db/_types.py` - –¥–æ–±–∞–≤–ª–µ–Ω `autoincrement=True`
- –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `2025_07_28_1746-ab208ca58172_add_autoincrement_to_primary_keys.py`
- –°–æ–∑–¥–∞–Ω—ã SEQUENCE –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü —Å primary key

**–ö–æ–¥ –º–∏–≥—Ä–∞—Ü–∏–∏:**
```sql
CREATE SEQUENCE IF NOT EXISTS quest_id_seq;
SELECT setval('quest_id_seq', COALESCE((SELECT MAX(id) FROM quest), 1));
ALTER TABLE quest ALTER COLUMN id SET DEFAULT nextval('quest_id_seq');
ALTER SEQUENCE quest_id_seq OWNED BY quest.id;
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–¥–∞ API

**–§–∞–π–ª:** `src/api/modules/quest/routers/quests.py`

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã `get_quest()` - —É–±—Ä–∞–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `quest_service`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã async/await –ø—Ä–æ–±–ª–µ–º—ã —Å `exceptions_mapper`
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω—ã enum –∑–Ω–∞—á–µ–Ω–∏—è: `GroupType.ALONE` ‚Üí `GroupType.TWO`

### 4. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ö–µ–º–∞–º

- ‚úÖ `type_photo` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç enum –∑–Ω–∞—á–µ–Ω–∏—è: `"Face verification"`, `"Photo Matching"`
- ‚úÖ `detections_radius` ‚â§ 10
- ‚úÖ `random_occurrence` - —á–∏—Å–ª–æ ‚â• 5

### 5. ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ê –í–ê–õ–ò–î–ê–¶–ò–Ø –û–¢–í–ï–¢–ê FASTAPI

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞—Å—Ç–æ–º–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª —Å—Ö–µ–º–µ `QuestReadSchema`, FastAPI –≤—ã–¥–∞–≤–∞–ª `ResponseValidationError`

**–†–µ—à–µ–Ω–∏–µ:** 
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã `get_quest()` - —É–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å aioinject
- –í–µ—Ä–Ω—É–ª–∏—Å—å –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É API –æ—Ç–≤–µ—Ç—É —á–µ—Ä–µ–∑ `get_quest(quest.id)`
- –¢–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ `QuestReadSchema` —Å–æ –≤—Å–µ–º–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

### üéâ –ü–û–õ–ù–´–ô –£–°–ü–ï–•!

**–ö–≤–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–º ID –∏ –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º–æ–π –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "id": 100004,  ‚Üê –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!
  "title": "üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –¢–ï–°–¢ API –û–¢–í–ï–¢–ê üéØ",
  "imageUrl": "http://localhost:9001/questcity-storage/images/quests/3ca3d4a3-dcad-45bc-b1e5-4d9ea50a2f03.png",
  "categoryId": 1,
  "difficulty": "Easy", 
  "price": 50.0,
  "credits": {"cost": 75, "reward": 200}
  // ... –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ QuestReadSchema
}
```

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
1. ‚úÖ –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç primary key - ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (100004)
2. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö API –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ 
3. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏—Å—Ö–æ–¥—è—â–∏—Ö API –¥–∞–Ω–Ω—ã—Ö - –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ QuestReadSchema
4. ‚úÖ Base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ MinIO
5. ‚úÖ Excel —Ñ–∞–π–ª—ã (mentor_preferences) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
6. ‚úÖ Enum –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö  
7. ‚úÖ SQL –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
8. ‚úÖ –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ MinIO: `http://localhost:9001/questcity-storage/images/quests/`
9. ‚úÖ FastAPI ResponseValidationError —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞
10. ‚úÖ –í—Å–µ –ø–æ–ª—è QuestReadSchema –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
- **QuestCreteSchema** ‚úÖ
- **Credits** ‚úÖ 
- **MainPreferences** ‚úÖ
- **PointCreateSchema** ‚úÖ
- **ImageValidateMixin** ‚úÖ
- **AutoIncrement Primary Key** ‚úÖ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç:

```bash
curl -X POST "http://localhost:8000/api/v1/quests/" \
  -H "Authorization: Bearer $(cat .admin_token)" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "üéâ –ü–û–õ–ù–´–ô –£–°–ü–ï–•! üéâ",
    "description": "–ü—Ä–æ–±–ª–µ–º–∞ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º primary key –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!",
    "image": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==",
    "credits": {"cost": 50, "reward": 150},
    "main_preferences": {"types": [], "places": [], "vehicles": [], "tools": []},
    "mentor_preferences": "UEsDBBQACIgnore...",
    "merch": [],
    "points": []
  }'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö–≤–µ—Å—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ —Å ID 100004 –∏ –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º–æ–π QuestReadSchema!

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:** 4
- **–°–æ–∑–¥–∞–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π:** 1  
- **–†–µ—à–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:** 10 (–≤–∫–ª—é—á–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–æ–≤ FastAPI)
- **–í—Ä–µ–º—è –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ:** 2.5 —á–∞—Å–∞
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ 100% –ó–ê–í–ï–†–®–ï–ù–û
- **–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç:** HTTP 200 OK —Å –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º–æ–π QuestReadSchema

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

- ‚úÖ [MED-013] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ API —Å–æ–∑–¥–∞–Ω–∏—è –∫–≤–µ—Å—Ç–æ–≤ - –ó–ê–í–ï–†–®–ï–ù–û
- üìù –û–±–Ω–æ–≤–ª–µ–Ω `TASKS.md` —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

---

**–ì–õ–ê–í–ù–û–ï –î–û–°–¢–ò–ñ–ï–ù–ò–ï:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º primary key (`duplicate key value violates unique constraint "pk_quest"`) –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞! –¢–µ–ø–µ—Ä—å API —Å–æ–∑–¥–∞–Ω–∏—è –∫–≤–µ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–º ID. 