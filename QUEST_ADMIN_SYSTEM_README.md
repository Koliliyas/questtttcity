# Система управления квестами для администраторов

## Обзор

Система управления квестами для администраторов предоставляет полный функционал для создания, редактирования и удаления квестов в приложении Questcity. Система включает в себя как бэкенд API, так и фронтенд интерфейс.

## Архитектура

### Бэкенд (Python/FastAPI)

#### Структура API

- **Создание квеста**: `POST /api/v1/quests/create`
- **Обновление квеста**: `PUT /api/v1/quests/update/{quest_id}`
- **Удаление квеста**: `DELETE /api/v1/quests/{quest_id}`
- **Список квестов для админа**: `GET /api/v1/quests/admin/list`
- **Управление точками квеста**:
  - `POST /api/v1/quests/{quest_id}/points` - создание точки
  - `PUT /api/v1/quests/{quest_id}/points/{point_id}` - обновление точки
  - `DELETE /api/v1/quests/{quest_id}/points/{point_id}` - удаление точки
  - `GET /api/v1/quests/{quest_id}/points` - список точек

#### Модели данных

**Quest (Квест):**
- Основная информация: название, описание, изображение
- Настройки сложности: уровень, пробег, тип группы, временные рамки
- Связи: категория, транспорт, место
- Кредиты: стоимость, награда, автоматическое начисление
- Цена: подписка, дополнительная плата

**Point (Точка квеста):**
- Название локации, описание, порядковый номер
- Тип активности, настройки фото
- Связанные места с координатами и настройками

#### Безопасность

- Проверка прав доступа через систему разрешений
- Валидация входных данных
- Защита от SQL-инъекций

### Фронтенд (Flutter)

#### Страницы

1. **QuestsListScreen** - список всех квестов с возможностью редактирования и удаления
2. **QuestCreateScreen** - форма создания нового квеста
3. **QuestEditScreen** - форма редактирования существующего квеста (планируется)

#### Состояние приложения

- **BLoC/Cubit** для управления состоянием
- **Валидация форм** на клиентской стороне
- **Обработка ошибок** с пользовательскими сообщениями

## Функциональность

### Создание квеста

1. **Основная информация:**
   - Название (обязательно, 1-128 символов)
   - Описание (обязательно, минимум 10 символов)
   - Изображение (обязательно)

2. **Настройки сложности:**
   - Уровень: Easy, Medium, Hard, Expert
   - Тип группы: Solo, Duo, Team, Family
   - Пробег: Short, Medium, Long, Marathon
   - Временные рамки: 1-2 hours, 3-5 hours, 6-8 hours, Full day

3. **Связанные сущности:**
   - Категория (обязательно)
   - Транспорт (обязательно)
   - Место (обязательно)

4. **Кредиты и награды:**
   - Стоимость квеста
   - Награда за прохождение
   - Автоматическое начисление

### Редактирование квеста

- Все поля из создания квеста доступны для изменения
- Валидация при обновлении
- Сохранение истории изменений

### Управление точками квеста

- Создание точек с настройками
- Управление местами в точках
- Настройка порядка прохождения

## Установка и запуск

### Бэкенд

1. Перейдите в папку `questcity-backend`
2. Установите зависимости: `pip install -r requirements.txt`
3. Настройте переменные окружения
4. Запустите сервер: `uvicorn src.app:app --reload`

### Фронтенд

1. Перейдите в папку `questcity-frontend`
2. Установите зависимости: `flutter pub get`
3. Запустите приложение: `flutter run`

## Использование

### Для администраторов

1. **Вход в систему** с правами администратора
2. **Переход к управлению квестами** через админ панель
3. **Создание нового квеста:**
   - Заполнение основной информации
   - Выбор настроек сложности
   - Привязка к категории, транспорту и месту
   - Загрузка изображения
4. **Редактирование существующих квестов**
5. **Удаление квестов** (с подтверждением)

### API интеграция

```bash
# Создание квеста
curl -X POST "http://localhost:8000/api/v1/quests/create" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Название квеста",
    "description": "Описание квеста",
    "image": "base64_image_data",
    "credits": {
      "auto": false,
      "cost": 100,
      "reward": 200
    },
    "main_preferences": {
      "category_id": 1,
      "vehicle_id": 1,
      "place_id": 1,
      "group": "Solo",
      "level": "Easy",
      "milege": "Short"
    }
  }'
```

## Разработка

### Добавление новых полей

1. **Бэкенд:**
   - Обновить модель в `src/db/models/quest/quest.py`
   - Добавить поле в DTO в `src/core/quest/dto.py`
   - Обновить схемы в `src/api/modules/quest/schemas/quest.py`
   - Обновить API эндпоинты

2. **Фронтенд:**
   - Добавить поле в форму
   - Обновить Cubit для управления состоянием
   - Добавить валидацию

### Тестирование

- **Unit тесты** для бэкенда
- **Widget тесты** для Flutter компонентов
- **Integration тесты** для полного цикла

## Безопасность

### Права доступа

- `CREATE_QUESTS` - создание квестов
- `EDIT_QUESTS` - редактирование квестов
- `DELETE_QUESTS` - удаление квестов

### Валидация

- Проверка обязательных полей
- Валидация форматов данных
- Проверка бизнес-правил
- Валидация связей между сущностями

## Мониторинг и логирование

- Логирование всех операций с квестами
- Отслеживание изменений
- Мониторинг производительности API

## Планы развития

1. **Расширенное управление точками** с drag-and-drop интерфейсом
2. **Шаблоны квестов** для быстрого создания
3. **Массовые операции** с квестами
4. **Аналитика и статистика** по квестам
5. **Система версионирования** квестов
6. **Интеграция с внешними сервисами**

## Поддержка

При возникновении проблем:

1. Проверьте логи приложения
2. Убедитесь в корректности прав доступа
3. Проверьте валидность входных данных
4. Обратитесь к документации API

## Лицензия

Проект разработан для внутреннего использования Questcity.





















